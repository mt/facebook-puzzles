/*1297741326,176820405*/

if (window.CavalryLogger) { CavalryLogger.start_js(["9o2n3"]); }

var baseurl='/badge.php?';var updatesDisabled=false;var pendingUpdate=false;function UpdatePreview(a,j){if(updatesDisabled){pendingUpdate=true;return;}updatesDisabled=true;pendingUpdate=false;var k=$('layout_vert').checked;var b=$('layout_horiz').checked;var h=$('layout_twocols').checked;var e=a['items[]'];var f='';if(e.value){f+='&items[]='+e.value;}else for(var c=0;c<e.length;c++)if(e[c].checked)f+='&items[]='+e[c].value;var g=$('preview_area');$('bigger_badge_box').style.width='320px';if(k){f+='&layout=vert';g.style.width='120px';}else if(b){f+='&layout=horiz';g.style.width='380px';}else if(h){f+='&layout=twocols';g.style.width='380px';}f+='&id='+j;DOM.empty(g);g.innerHTML=_tx("Loading...");var i=baseurl+f+'&format=png';var d=new Image();d.onload=function(){var l='<img src="'+i+'">';g.innerHTML=l;updatesDisabled=false;if(pendingUpdate)UpdatePreview(a,j);};d.onerror=function(){g.innerHTML=_tx("Error loading badge.");updatesDisabled=false;if(pendingUpdate)UpdatePreview(a,j);};d.src=i;}function AddItem(d){var a=$('end_item_selector');var b=a.previousSibling;var c=b.cloneNode(true);c.firstChild.selectedIndex=1;b.parentNode.insertBefore(c,a);UpdatePreview($("edit_badge"),d);}function RemoveItem(a,d){var c=a.parentNode;var b=$('edit_badge')['items[]'];if(!b[0].length){alert(_tx("Cannot remove the last item."));}else{c.parentNode.removeChild(c);UpdatePreview($("edit_badge"),d);}return false;}
function UINav(a,c,b){this.controller=a;this.data=b;copy_properties(this,{controller:a,data:b,items:[],selectedItem:null,selectedClass:this.selectedClass||''});this.initializeItems(c);UINav.instances[a.id]=this;}UINav.instances={};UINav.prototype.getItemContainers=abstractMethod;UINav.prototype.getItemLinks=abstractMethod;UINav.prototype.getItems=function(){return this.items;};UINav.prototype.initializeItems=function(d){var a=this.getItemContainers();for(var b=0;b<a.length;b++){var e=DOM.scry(a[b],'a')[0];if(!e)break;var c={};if(this.is_wrapped){c=(d[b]||{});}else c={container:a[b],link:e,data:(d[b]||{})};this.items.push(c);if(CSS.hasClass(c.container,this.selectedClass))this.selectedItem=c;c.addClickHandler=this.addClickHandler.bind(this,c);c.addClickHandler(this.selectItem.bind(this,c));}};UINav.prototype.selectItem=function(a){if(a==this.selectedItem)return true;if(this.selectedItem)CSS.removeClass(this.selectedItem.container,this.selectedClass);if(a)CSS.addClass(a.container,this.selectedClass);this.selectedItem=a;return true;};UINav.prototype.deselectAll=function(){if(this.selectedItem)CSS.removeClass(this.selectedItem.container,this.selectedClass);this.selectedItem=null;};UINav.prototype.getSelectedItem=function(){return this.selectedItem;};UINav.prototype.addClickHandler=function(b,a){if(typeof b=='function'){a=b;this.getItems().each(function(c,d){this.addClickHandler(d,c);}.bind(this,a));return true;}else return Event.listen(b.link,'click',a);};function UINavGeneric(a,c,b){if(!this.selectedClass)this.selectedClass='UINavGeneric_ItemSelected';this.parent.construct(this,a,c,b);}UINavGeneric.extend('UINav');UINavGeneric.prototype.getItemContainers=function(){if(!this.containers)this.containers=DOM.scry(this.controller,'li');return this.containers;};UINavGeneric.prototype.getItemLinks=function(){if(!this.containerLinks)this.containerLinks=DOM.scry(this.controller,'li a');return this.containerLinks;};function UITabStructure(a,c,b){if(!this.selectedClass)this.selectedClass='UITabStructure_TabSelected';this.parent.construct(this,a,c,b);}UITabStructure.extend('UINavGeneric');UITabStructure.prototype.getItemContainers=function(){if(!this.tab_containers){this.tab_containers=[];var b=DOM.scry(this.controller,'li');for(var a=0;a<b.length;a++)this.tab_containers.push(b[a].childNodes[0]);}return this.tab_containers;};function UISourceList(a,c,b){if(!this.selectedClass)this.selectedClass='UISourceList_ItemSelected';this.parent.construct(this,a,c,b);}UISourceList.extend('UINavGeneric');
function UIFilterList(a,c,b){this.selectedClass='selected';this._itemsContainer=DOM.scry(a,'div.UIFilterList_List')[0];this.parent.construct(this,a,c,b);}UIFilterList.extend('UINav');UIFilterList.prototype.getItemContainers=function(){if(!this.containers)this.containers=DOM.scry(this.controller,'div.UIFilterList_Item');return this.containers;};UIFilterList.prototype.getItemLinks=function(){if(!this.containerLinks)this.containerLinks=DOM.scry(this.controller,'div.UIFilterList_Item a');return this.containerLinks;};UIFilterList.prototype.resetItemContainers=function(){this.containers=null;};UIFilterList.prototype.resetItemLinks=function(){this.containerLinks=null;};UIFilterList.prototype.setEditIconHandler=function(a){this._editIconHandler=a;return this;};UIFilterList.prototype.setLoading=function(a){CSS.conditionClass(this.controller,'UIFilterList_Loading',a);};UIFilterList.prototype.setCreateLinkHandler=function(b){var a=DOM.find(this.controller,'a.UIFilterList_Create');Event.listen(a,'click',b);};UIFilterList.prototype.addItem=function(l,b,k,c,a){if(!k)k=0;var g=this.getItems();a=a?a:{};var j=$N('div',{className:'UIFilterList_Item'});var h=$N('a',{className:'UIFilterList_ItemLink',href:b});if(c){var d=$N('span',{className:'UIImageBlock_Image UIFilterList_Icon'});CSS.setStyle(d,'backgroundImage','url('+c+')');var e=$N('div',{className:'UIImageBlock clearfix'});DOM.appendContent(e,d);DOM.appendContent(e,$N('div',{className:'UIImageBlock_Content UIFilterList_Title'},l));DOM.appendContent(h,e);}else DOM.appendContent(h,$N('div',{className:'UIImageBlock_Content UIFilterList_Title '+'UIFilterList_TitleWithoutIcon'},l));var i=$N('span',{className:'UIFilterList_LoadingIndicator'});DOM.setContent(j,[h,i]);var f={container:j,link:h,data:a};if(g.length>0){if(this.getItems()[k]){DOM.insertBefore(j,g[k].container);}else{k=k-1;DOM.insertAfter(g[k].container,j);}}else{DOM.appendContent(this._itemsContainer,j);CSS.removeClass(this.controller,'UIFilterList_HasBlankState');}this.getItems().splice(k,0,f);this.getItemContainers().splice(k,0,f.container);this.getItemLinks().splice(k,0,f.link);return f;};UIFilterList.prototype.setItemTitle=function(a,b){var c=DOM.find(a.link,'div.UIFilterList_Title');DOM.setContent(c,b);};UIFilterList.prototype.removeItem=function(b){var d=this.getItems();var c=null;for(var a=0;a<d.length;a++)if(d[a]==b){c=a;break;}if(c!=null){if(this.selectedItem==b)this.selectItem(null);this.getItemContainers().splice(c,1);this.getItemLinks().splice(c,1);this.getItems().splice(c,1);DOM.remove(b.container);}if(d.length==0)CSS.addClass(this.controller,'UIFilterList_HasBlankState');};

if (window.Bootloader) { Bootloader.done(["9o2n3"]); }